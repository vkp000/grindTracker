<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Striver A2Z DSA ‚Äì Java Viewer</title>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-java.min.js"></script>

<style>
:root{
  --bg:#ffffff;--panel:#f5f5f5;--text:#111;
  --hover:#e5e7eb;--active:#2563eb;--border:#ddd;
}
body.dark{
  --bg:#0f172a;--panel:#020617;--text:#e5e7eb;
  --hover:#1e293b;--active:#1d4ed8;--border:#1e293b;
}
*{box-sizing:border-box}
body{
  margin:0;height:100vh;display:flex;flex-direction:column;
  font-family:system-ui,sans-serif;background:var(--bg);color:var(--text);
}

/* ===== TOP BAR ===== */
#topbar{
  height:44px;
  background:linear-gradient(180deg,#0b1220,#020617);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:flex-end;
  gap:12px;padding:0 12px;
}
#progressCount{font-size:13px}
#toggle{
  cursor:pointer;border:1px solid var(--border);
  background:transparent;color:var(--text);
  border-radius:6px;padding:4px 10px;
}

/* ===== LAYOUT ===== */
#main{flex:1;display:flex;overflow:hidden}

/* ===== SIDEBAR ===== */
#sidebar{
  width:330px;background:var(--panel);
  border-right:1px solid var(--border);
  overflow-y:auto;
}
#tree{padding:8px;font-size:13.5px}

/* ===== TREE ===== */
.tree-item{
  display:flex;align-items:center;gap:6px;
  padding:4px 6px;border-radius:6px;
  cursor:pointer;white-space:nowrap;overflow:hidden;
}
.tree-item:hover{background:var(--hover)}
.tree-item.active{background:var(--active);color:white}

.chevron{width:12px}
.star{width:14px;text-align:center;cursor:pointer;opacity:.35}
.star.solved{color:#facc15;opacity:1}
.icon{width:16px}
.label{flex:1;overflow:hidden;text-overflow:ellipsis}

.children{
  margin-left:18px;border-left:1px solid var(--border);
  padding-left:6px;
}

/* ===== VIEW ===== */
#view{flex:1;padding:20px;overflow-y:auto}

/* ===== FILE HEADER ===== */
.file-header{
  display:flex;align-items:center;gap:10px;
  padding:12px 14px;margin-bottom:12px;
  border-radius:8px;
  font-size:20px;font-weight:600;
  background:rgba(0,0,0,.25);
}
body:not(.dark) .file-header{background:#eef2f7}

/* ===== EDITOR ===== */
.editor{position:relative}

.editor-actions{
  display:flex;
  justify-content:flex-end;
  align-items:center;
  gap:8px;
  margin-bottom:10px;
}

.link-logo{
  width:22px;height:22px;
  border-radius:4px;
  cursor:pointer;
  background:#fff;
  padding:2px;
  border:1px solid var(--border);
}

.copy-btn{
  font-size:12px;padding:4px 8px;border-radius:6px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.6);color:white;cursor:pointer;
}

/* ‚≠ê editor star */
.editor-star{
  font-size:18px;
  cursor:pointer;
  opacity:.4;
  user-select:none;

  width:32px;          /* üëà WIDTH increase */
  height:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:6px;
}
.editor-star:hover{
  background:rgba(255,255,255,0.08);
}

.editor-star.solved{
  color:#facc15;
  opacity:1;
}

pre{
  background:#0d1117!important;color:#c9d1d9;
  padding:16px;border-radius:8px;
  overflow-x:auto;line-height:1.6;
}
.token.comment{
  color:rgba(106,153,85,.85)!important;
  font-style:italic;
}
</style>
</head>

<body>

<div id="topbar">
  <div id="progressCount">‚≠ê 0 / 0</div>
  <button id="toggle">üåô</button>
</div>

<div id="main">
  <div id="sidebar"><div id="tree"></div></div>
  <div id="view">üìò Select a file</div>
</div>

<script>
const ROOT="StriverA2Z";
const tree=document.getElementById("tree");
const view=document.getElementById("view");
const toggle=document.getElementById("toggle");
const progressEl=document.getElementById("progressCount");

const LAST_VISITED_KEY="lastVisitedFile";
let TOTAL_FILES=0;

/* ===== THEME ===== */
if(localStorage.theme==="dark"){
  document.body.classList.add("dark");
  toggle.textContent="‚òÄÔ∏è";
}
toggle.onclick=()=>{
  document.body.classList.toggle("dark");
  toggle.textContent=document.body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";
  localStorage.theme=document.body.classList.contains("dark")?"dark":"light";
};

/* ===== HELPERS ===== */
const escapeHtml=s=>s.replace(/[&<>"']/g,m=>(
  {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]
));
const solvedKey=p=>`solved:${p}`;
const delay=t=>new Promise(r=>setTimeout(r,t));

function extractLinks(text){
  const regex=/(https?:\/\/[^\s]+)/g;
  const matches=text.match(regex)||[];
  return [...new Set(matches.map(u=>u.replace(/[)\],.;:]+$/g,"")))];
}
function faviconURL(url){
  try{
    const d=new URL(url).hostname;
    return `https://www.google.com/s2/favicons?sz=64&domain=${d}`;
  }catch{return"";}
}

async function loadFolder(p){
  return fetch(`${p}/index.json`).then(r=>r.json());
}

/* ===== TOTAL COUNT ===== */
async function countAllFiles(folder){
  let c=0;
  const data=await loadFolder(folder);
  for(const i of data){
    if(i.type==="file"&&(i.name.endsWith(".java")||i.name.endsWith(".md"))) c++;
    if(i.type==="folder") c+=await countAllFiles(`${folder}/${i.name}`);
  }
  return c;
}

/* ===== PROGRESS ===== */
function updateProgress(){
  let s=0;
  for(const k in localStorage)
    if(k.startsWith("solved:")&&localStorage[k]==="true") s++;
  progressEl.textContent=`‚≠ê ${s} / ${TOTAL_FILES}`;
}

/* ===== TREE ===== */
function createItem(item,base=""){
  const fullPath=base+item.name;
  const track=item.type==="file"&&(item.name.endsWith(".java")||item.name.endsWith(".md"));
  const solved=localStorage.getItem(solvedKey(fullPath))==="true";

  const row=document.createElement("div");
  row.className="tree-item";
  row.dataset.path=fullPath;

  row.innerHTML=`
    <span class="chevron">${item.type==="folder"?"‚ñ∂":""}</span>
    ${track?`<span class="star ${solved?"solved":""}">‚òÖ</span>`:`<span class="star"></span>`}
    <span class="icon">${item.type==="folder"?"üìÅ":"üìÑ"}</span>
    <span class="label">${item.name}</span>
  `;

  if(item.type==="folder"){
    let open=false,container;
    row.onclick=async e=>{
      e.stopPropagation();
      if(!container){
        const data=await loadFolder(`${ROOT}/${fullPath}`);
        container=document.createElement("div");
        container.className="children";
        data.forEach(c=>container.appendChild(createItem(c,`${fullPath}/`)));
        row.after(container);
      }
      open=!open;
      row.querySelector(".chevron").textContent=open?"‚ñº":"‚ñ∂";
      container.style.display=open?"block":"none";
    };
  }else{
    row.querySelector(".star")?.addEventListener("click",e=>{
      e.stopPropagation();
      const st=!row.querySelector(".star").classList.contains("solved");
      row.querySelector(".star").classList.toggle("solved",st);
      localStorage.setItem(solvedKey(fullPath),st);
      updateProgress();
    });

    row.onclick=async()=>{
      localStorage.setItem(LAST_VISITED_KEY,fullPath);
      document.querySelectorAll(".tree-item.active").forEach(x=>x.classList.remove("active"));
      row.classList.add("active");

      const txt=await fetch(`${ROOT}/${fullPath}`).then(r=>r.text());
      const links=extractLinks(txt);
      const isSolved=localStorage.getItem(solvedKey(fullPath))==="true";

      const actionBar=`
        <div class="editor-actions">
          ${links.map(l=>`
            <img class="link-logo" src="${faviconURL(l)}"
                 title="${l}" data-link="${l}" />
          `).join("")}
          <button class="copy-btn">Copy</button>
          <span class="editor-star ${isSolved?"solved":""}">‚òÖ</span>
        </div>
      `;

      view.innerHTML=item.name.endsWith(".md")
        ? `<div class="file-header">üìÑ ${item.name}</div>${actionBar}${marked.parse(txt)}`
        : `<div class="file-header">üìÑ ${item.name}</div>
           <div class="editor">${actionBar}
             <pre><code class="language-java">${escapeHtml(txt)}</code></pre>
           </div>`;

      Prism.highlightAll();

      const copyBtn = view.querySelector(".copy-btn");
if (copyBtn) {
  copyBtn.onclick = () => {
    navigator.clipboard.writeText(txt);

    const oldText = copyBtn.textContent;
    copyBtn.textContent = "Copied";

    setTimeout(() => {
      copyBtn.textContent = oldText;
    }, 3000);
  };
}


      view.querySelectorAll(".link-logo").forEach(img=>{
        img.onclick=()=>window.open(img.dataset.link,"_blank","noopener,noreferrer");
      });

      const editorStar=view.querySelector(".editor-star");
      if(editorStar){
        editorStar.onclick=()=>{
          const s=!editorStar.classList.contains("solved");
          editorStar.classList.toggle("solved",s);
          localStorage.setItem(solvedKey(fullPath),s);
          updateProgress();
          document.querySelector(
            `.tree-item[data-path="${fullPath}"] .star`
          )?.classList.toggle("solved",s);
        };
      }
    };
  }
  return row;
}

/* ===== RESTORE LAST VISITED ===== */
async function openPathAndSelect(path){
  const parts=path.split("/");
  let container=tree,base="";
  for(let i=0;i<parts.length;i++){
    const n=[...container.children].find(x=>x.dataset.path===base+parts[i]);
    if(!n) return;
    if(i<parts.length-1){
      n.click();await delay(200);
      container=n.nextSibling;base+=parts[i]+"/";
    }else n.click();
  }
}

/* ===== INIT ===== */
(async()=>{
  TOTAL_FILES=await countAllFiles(ROOT);
  const root=await loadFolder(ROOT);
  root.forEach(i=>tree.appendChild(createItem(i)));
  updateProgress();

  const last=localStorage.getItem(LAST_VISITED_KEY);
  if(last) openPathAndSelect(last);
})();
</script>

</body>
</html>
