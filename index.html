<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Striver A2Z DSA ‚Äì Java Viewer</title>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-java.min.js"></script>

  <style>
    :root {
      --bg: #ffffff;
      --panel: #f5f5f5;
      --text: #111;
      --hover: #e5e7eb;
      --active: #2563eb;
      --border: #ddd;
      --yellow: #facc15;
    }

    body.dark {
      --bg: #0f172a;
      --panel: #020617;
      --text: #e5e7eb;
      --hover: #1e293b;
      --active: #1d4ed8;
      --border: #1e293b;
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    /* ===== TOP BAR ===== */
    #topbar {
      height: 44px;
      background: linear-gradient(180deg, #0b1220, #020617);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 12px;
      padding: 0 12px;
    }

    #progressCount {
      font-size: 13px
    }

    #toggle {
      cursor: pointer;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      border-radius: 6px;
      padding: 4px 10px;
    }

    /* ===== LAYOUT ===== */
    #main {
      flex: 1;
      display: flex;
      overflow: hidden
    }

    /* ===== SIDEBAR ===== */
    #sidebar {
      width: 330px;
      background: var(--panel);
      border-right: 1px solid var(--border);
      overflow-y: auto;
    }

    #tree {
      padding: 8px;
      font-size: 13.5px
    }

    /* ===== TREE ===== */
    .tree-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px;
      border-radius: 6px;
      cursor: pointer;
      white-space: nowrap;
      overflow: hidden;
    }

    .tree-item:hover {
      background: var(--hover)
    }

    .tree-item.active {
      background: var(--active);
      color: white
    }

    .chevron {
      width: 12px
    }

    .icon {
      width: 16px
    }

    .label {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis
    }

    .children {
      margin-left: 18px;
      border-left: 1px solid var(--border);
      padding-left: 6px;
    }

    /* ===== CHECKBOX ===== */
    .cb {
      width: 16px;
      height: 16px;
      border: 2px solid var(--yellow);
      border-radius: 3px;
      position: relative;
      cursor: pointer;
    }

    .cb.checked {
      background: var(--yellow)
    }

    .cb.checked::after {
      content: "";
      position: absolute;
      left: 3px;
      top: 0px;
      width: 5px;
      height: 9px;
      border: solid #000;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }

    #view {
      flex: 1;
      padding: 20px;
      overflow-y: auto
    }


    /* ===== BIGGER EDITOR CHECKBOX ===== */
    .editor-checkbox {
      width: 38px;
      height: 38px;
      border-width: 3px;
    }

    .editor-checkbox.checked::after {
      left: 11px;
      top: 5px;
      width: 8px;
      height: 12px;
      border-width: 0 3px 3px 0;
    }

    /* ===== FILE HEADER ===== */
    .file-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      margin-bottom: 12px;
      border-radius: 8px;
      font-size: 22px;
      font-weight: 600;
      background: rgba(0, 0, 0, .25);
    }

    body:not(.dark) .file-header {
      background: #eef2f7
    }

    /* ===== EDITOR ACTIONS ===== */
    .editor-actions {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .link-logo {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      cursor: pointer;
      background: #fff;
      padding: 2px;
      border: 1px solid var(--border);
    }

    .copy-btn {
      font-size: 12px;
      padding: 12px 20px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, .6);
      color: white;
      cursor: pointer;
    }

    .editor-checkbox {
      margin-left: 8px
    }

    pre {
      background: #0d1117 !important;
      color: #c9d1d9;
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      line-height: 1.6;
    }
  </style>
</head>

<body>

  <div id="topbar">
    <div id="progressCount">‚úî Loading...</div>
    <button id="toggle">üåô</button>
  </div>

  <div id="main">
    <div id="sidebar">
      <div id="tree"></div>
    </div>
    <div id="view">üìò Select a file</div>
  </div>

  <script>
    const ROOT = "StriverA2Z";
    const TOTAL_COUNT_KEY = "totalFileCount";
    const solvedKey = p => `solved:${p}`;

    const tree = document.getElementById("tree");
    const view = document.getElementById("view");
    const toggle = document.getElementById("toggle");
    const progressEl = document.getElementById("progressCount");

    let TOTAL_FILES = Number(localStorage.getItem(TOTAL_COUNT_KEY)) || null;

    /* ===== THEME ===== */
    if (localStorage.theme === "dark") {
      document.body.classList.add("dark");
      toggle.textContent = "‚òÄÔ∏è";
    }
    toggle.onclick = () => {
      document.body.classList.toggle("dark");
      toggle.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
      localStorage.theme = document.body.classList.contains("dark") ? "dark" : "light";
    };

    /* ===== PROGRESS ===== */
    function getSolvedCount() {
      let c = 0;
      for (const k in localStorage)
        if (k.startsWith("solved:") && localStorage[k] === "true") c++;
      return c;
    }

    function updateProgress() {
      const solved = getSolvedCount();
      progressEl.textContent = TOTAL_FILES
        ? `‚úî ${solved} / ${TOTAL_FILES}`
        : `‚úî ${solved} / ‚Ä¶`;
    }

    /* ===== HELPERS ===== */
    function extractLinks(t) {
      return [...new Set(
        (t.match(/https?:\/\/[^\s]+/g) || [])
          .map(u => u.replace(/[)\],.;:]+$/g, ""))
      )];
    }
    function faviconURL(u) {
      try {
        return `https://www.google.com/s2/favicons?sz=64&domain=${new URL(u).hostname}`;
      } catch { return ""; }
    }
    async function loadFolder(p) {
      return fetch(`${p}/index.json`).then(r => r.json());
    }

    /* ===== BACKGROUND TOTAL COUNT ===== */
    async function countAllFiles(folder) {
      let c = 0;
      const data = await loadFolder(folder);
      for (const i of data) {
        if (i.type === "file" && (i.name.endsWith(".java") || i.name.endsWith(".md"))) c++;
        if (i.type === "folder") c += await countAllFiles(`${folder}/${i.name}`);
      }
      return c;
    }

    /* ===== TREE ===== */
    function createItem(item, base = "") {
      const full = base + item.name;
      const track = item.type === "file" && (item.name.endsWith(".java") || item.name.endsWith(".md"));
      const solved = localStorage.getItem(solvedKey(full)) === "true";

      const row = document.createElement("div");
      row.className = "tree-item";
      row.dataset.path = full;

      row.innerHTML = `
    <span class="chevron">${item.type === "folder" ? "‚ñ∂" : ""}</span>
    ${track ? `<span class="cb ${solved ? "checked" : ""}"></span>` : `<span style="width:16px"></span>`}
    <span class="icon">${item.type === "folder" ? "üìÅ" : "üìÑ"}</span>
    <span class="label">${item.name}</span>
  `;

      if (item.type === "folder") {
        let open = false, cont;
        row.onclick = async () => {
          if (!cont) {
            const d = await loadFolder(`${ROOT}/${full}`);
            cont = document.createElement("div");
            cont.className = "children";
            d.forEach(c => cont.appendChild(createItem(c, `${full}/`)));
            row.after(cont);
          }
          open = !open;
          row.querySelector(".chevron").textContent = open ? "‚ñº" : "‚ñ∂";
          cont.style.display = open ? "block" : "none";
        };
      } else {
        const cb = row.querySelector('.cb');
        if (cb) {
          cb.onclick = e => {
            e.stopPropagation();
            const s = !cb.classList.contains('checked');
            cb.classList.toggle('checked', s);
            localStorage.setItem(solvedKey(full), s);

            // üëá editor checkbox sync IF same file open
            const openEditorCheckbox = view.querySelector('.editor-checkbox');
            if (
              openEditorCheckbox &&
              view.querySelector('.file-header')?.textContent === item.name
            ) {
              openEditorCheckbox.classList.toggle('checked', s);
            }

            updateProgress();
          };

        }

        row.onclick = async () => {
          document.querySelectorAll('.tree-item.active').forEach(x => x.classList.remove('active'));
          row.classList.add('active');

          const txt = await fetch(`${ROOT}/${full}`).then(r => r.text());
          const links = extractLinks(txt);
          const isSolved = localStorage.getItem(solvedKey(full)) === "true";

          view.innerHTML = `
        <div class="file-header">${item.name}</div>
        <div class="editor-actions">
          ${links.map(l => `<img class="link-logo" src="${faviconURL(l)}" data-link="${l}" />`).join("")}
          <button class="copy-btn">Copy</button>
          <span class="cb editor-checkbox ${isSolved ? "checked" : ""}"></span>
        </div>
        ${item.name.endsWith('.md')
              ? marked.parse(txt)
              : `<pre><code class="language-java">${txt.replace(/</g, "&lt;")}</code></pre>`
            }
      `;

          Prism.highlightAll();

          const copyBtn = view.querySelector('.copy-btn');

          copyBtn.onclick = () => {
            navigator.clipboard.writeText(txt);

            const oldText = copyBtn.textContent;
            copyBtn.textContent = "Copied";

            setTimeout(() => {
              copyBtn.textContent = oldText;
            }, 3000);
          };


          view.querySelectorAll('.link-logo').forEach(i => {
            i.onclick = () => window.open(i.dataset.link, '_blank', 'noopener');
          });

          const ecb = view.querySelector('.editor-checkbox');
          ecb.onclick = () => {
            const s = !ecb.classList.contains('checked');
            ecb.classList.toggle('checked', s);
            localStorage.setItem(solvedKey(full), s);
            row.querySelector('.cb')?.classList.toggle('checked', s);
            updateProgress();
          };
        };
      }
      return row;
    }

    /* ===== INIT ===== */
    (async () => {
      updateProgress();

      const root = await loadFolder(ROOT);
      root.forEach(i => tree.appendChild(createItem(i)));

      (async () => {
        const fresh = await countAllFiles(ROOT);
        if (fresh !== TOTAL_FILES) {
          TOTAL_FILES = fresh;
          localStorage.setItem(TOTAL_COUNT_KEY, fresh);
          updateProgress();
        }
      })();
    })();
  </script>

</body>

</html>