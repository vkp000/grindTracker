<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Striver A2Z DSA ‚Äì Java Viewer</title>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-java.min.js"></script>

<style>
:root{
  --bg:#ffffff;--panel:#f5f5f5;--text:#111;
  --hover:#e5e7eb;--active:#2563eb;--border:#ddd;
}
body.dark{
  --bg:#0f172a;--panel:#020617;--text:#e5e7eb;
  --hover:#1e293b;--active:#1d4ed8;--border:#1e293b;
}
*{box-sizing:border-box}
body{
  margin:0;height:100vh;display:flex;flex-direction:column;
  font-family:system-ui,sans-serif;background:var(--bg);color:var(--text);
}

/* ===== TOP BAR ===== */
#topbar{
  height:44px;
  background:linear-gradient(180deg,#0b1220,#020617);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:flex-end;
  gap:12px;padding:0 12px;
}
#progressCount{font-size:13px}
#toggle{
  cursor:pointer;border:1px solid var(--border);
  background:transparent;color:var(--text);
  border-radius:6px;padding:4px 10px;
}

/* ===== LAYOUT ===== */
#main{flex:1;display:flex;overflow:hidden}

/* ===== SIDEBAR ===== */
#sidebar{
  width:330px;background:var(--panel);
  border-right:1px solid var(--border);
  overflow-y:auto;
}
#tree{padding:8px;font-size:13.5px}

/* ===== TREE ===== */
.tree-item{
  display:flex;align-items:center;gap:6px;
  padding:4px 6px;border-radius:6px;
  cursor:pointer;white-space:nowrap;overflow:hidden;
}
.tree-item:hover{background:var(--hover)}
.tree-item.active{background:var(--active);color:white}

.chevron{width:12px}
.star{width:14px;text-align:center;cursor:pointer;opacity:.35}
.star.solved{color:#facc15;opacity:1}
.icon{width:16px}
.label{flex:1;overflow:hidden;text-overflow:ellipsis}

.children{
  margin-left:18px;border-left:1px solid var(--border);
  padding-left:6px;
}

/* ===== VIEW ===== */
#view{flex:1;padding:20px;overflow-y:auto}

/* ===== FILE HEADER ===== */
.file-header{
  display:flex;align-items:center;gap:10px;
  padding:12px 14px;margin-bottom:12px;
  border-radius:8px;
  font-size:22px;font-weight:600;
  background:rgba(0,0,0,.25);
}
body:not(.dark) .file-header{background:#eef2f7}

/* ===== EDITOR ===== */
.editor-actions{
  display:flex;justify-content:flex-end;align-items:center;
  gap:8px;margin-bottom:10px;
}
.link-logo{
  width:22px;height:22px;border-radius:4px;
  cursor:pointer;background:#fff;padding:2px;
  border:1px solid var(--border);
}
.copy-btn{
  font-size:12px;padding:4px 10px;border-radius:6px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.6);color:white;cursor:pointer;
}
.editor-star{
  font-size:18px;cursor:pointer;opacity:.4;
  width:32px;height:28px;
  display:flex;align-items:center;justify-content:center;
  border-radius:6px;
}
.editor-star.solved{color:#facc15;opacity:1}

pre{
  background:#0d1117!important;color:#c9d1d9;
  padding:16px;border-radius:8px;
}
.token.comment{
  color:rgba(106,153,85,.85)!important;
  font-style:italic;
}
</style>
</head>

<body>

<div id="topbar">
  <div id="progressCount">‚≠ê Loading...</div>
  <button id="toggle">üåô</button>
</div>

<div id="main">
  <div id="sidebar"><div id="tree"></div></div>
  <div id="view">üìò Select a file</div>
</div>

<script>
const ROOT="StriverA2Z";
const TOTAL_COUNT_KEY="totalFileCount";
const LAST_VISITED_KEY="lastVisitedFile";

const tree=document.getElementById("tree");
const view=document.getElementById("view");
const toggle=document.getElementById("toggle");
const progressEl=document.getElementById("progressCount");

let TOTAL_FILES = Number(localStorage.getItem(TOTAL_COUNT_KEY)) || null;

/* ===== THEME ===== */
if(localStorage.theme==="dark"){
  document.body.classList.add("dark");
  toggle.textContent="‚òÄÔ∏è";
}
toggle.onclick=()=>{
  document.body.classList.toggle("dark");
  toggle.textContent=document.body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";
  localStorage.theme=document.body.classList.contains("dark")?"dark":"light";
};

/* ===== HELPERS ===== */
const solvedKey=p=>`solved:${p}`;
const delay=t=>new Promise(r=>setTimeout(r,t));

function getSolvedCount(){
  let s=0;
  for(const k in localStorage)
    if(k.startsWith("solved:")&&localStorage[k]==="true") s++;
  return s;
}
function updateProgress(){
  const solved=getSolvedCount();
  progressEl.textContent=TOTAL_FILES
    ? `‚≠ê ${solved} / ${TOTAL_FILES}`
    : `‚≠ê ${solved} / ‚Ä¶`;
}

async function loadFolder(p){
  return fetch(`${p}/index.json`).then(r=>r.json());
}

/* ===== BACKGROUND COUNT ===== */
async function countAllFiles(folder){
  let c=0;
  const data=await loadFolder(folder);
  for(const i of data){
    if(i.type==="file"&&(i.name.endsWith(".java")||i.name.endsWith(".md"))) c++;
    if(i.type==="folder") c+=await countAllFiles(`${folder}/${i.name}`);
  }
  return c;
}

/* ===== TREE ===== */
function createItem(item,base=""){
  const fullPath=base+item.name;
  const solved=localStorage.getItem(solvedKey(fullPath))==="true";

  const row=document.createElement("div");
  row.className="tree-item";
  row.dataset.path=fullPath;

  row.innerHTML=`
    <span class="chevron">${item.type==="folder"?"‚ñ∂":""}</span>
    ${item.type==="file"?`<span class="star ${solved?"solved":""}">‚òÖ</span>`:`<span class="star"></span>`}
    <span class="icon">${item.type==="folder"?"üìÅ":"üìÑ"}</span>
    <span class="label">${item.name}</span>
  `;

  if(item.type==="folder"){
    let open=false,container;
    row.onclick=async()=>{
      if(!container){
        const data=await loadFolder(`${ROOT}/${fullPath}`);
        container=document.createElement("div");
        container.className="children";
        data.forEach(c=>container.appendChild(createItem(c,`${fullPath}/`)));
        row.after(container);
      }
      open=!open;
      row.querySelector(".chevron").textContent=open?"‚ñº":"‚ñ∂";
      container.style.display=open?"block":"none";
    };
  }else{
    row.onclick=async()=>{
      localStorage.setItem(LAST_VISITED_KEY,fullPath);
      document.querySelectorAll(".tree-item.active").forEach(x=>x.classList.remove("active"));
      row.classList.add("active");

      const txt=await fetch(`${ROOT}/${fullPath}`).then(r=>r.text());
      view.innerHTML=`
        <div class="file-header">${item.name}</div>
        <div class="editor-actions">
          <button class="copy-btn">Copy</button>
          <span class="editor-star ${solved?"solved":""}">‚òÖ</span>
        </div>
        <pre><code class="language-java">${txt.replace(/</g,"&lt;")}</code></pre>
      `;
      Prism.highlightAll();
    };
  }
  return row;
}

/* ===== RESTORE LAST ===== */
async function openPathAndSelect(path){
  const parts=path.split("/");
  let container=tree,base="";
  for(let i=0;i<parts.length;i++){
    const n=[...container.children].find(x=>x.dataset.path===base+parts[i]);
    if(!n) return;
    if(i<parts.length-1){
      n.click();await delay(150);
      container=n.nextSibling;base+=parts[i]+"/";
    }else n.click();
  }
}

/* ===== INIT ===== */
(async()=>{
  updateProgress(); // uses cached total if available

  const root=await loadFolder(ROOT);
  root.forEach(i=>tree.appendChild(createItem(i)));

  const last=localStorage.getItem(LAST_VISITED_KEY);
  if(last) openPathAndSelect(last);

  // background recount
  (async()=>{
    const fresh=await countAllFiles(ROOT);
    if(fresh!==TOTAL_FILES){
      TOTAL_FILES=fresh;
      localStorage.setItem(TOTAL_COUNT_KEY,fresh);
      updateProgress();
    }
  })();
})();
</script>

</body>
</html>
